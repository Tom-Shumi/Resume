# 大量の未返信のスカウト削除プロジェクト

## 役割

- リードバックエンドエンジニア

## 使用技術

- SQL
- Shell
- Datadog

## プロジェクト期間

- 3 ヶ月

## 開発手法

- アジャイル（スクラム）

## ● プロジェクト概要

サービスを停止せずに、RDB に溜まっている不要なレコード(2 億件)を会員から見えなくする

## ● 担当

- リードバックエンドエンジニア
  - 要求事項をもとにステークホルダーと要件を決める
  - 対応方針に対して責任を持つ

## 開発

### 状況

- 2009 年にサービスが開始したプロダクトのリリース初期からあった機能を削除することになった。
- それに伴い過去から溜まっていた約 2 億のレコードに対して論理削除を行う必要があった。
- また削除期日もユーザに事前告知していたため、期日を超えることはできるだけ避けなければならない状況だった。

#### 課題

- 稼働しているサービスに影響が出ないように安全にレコードを削除する必要があった。
- 削除対象が格納されていたテーブルには、必要なレコードも残っており、テーブルごと一括で削除というような方法は取ることができなかった。

#### アクション

- テーブルへのロックや、ロングトランザクションに伴う Slave DB へのレプリカラグを考慮して、細かい件数に分割して論理削除の SQL を実行することにした。
- 上記を安全に実現するための shell script を作成した。
- また shell script 実行中に問題が発生した際、すぐ対応できるような監視体制整え、問題が発生してしまった時の対応を事前にドキュメント化して、万全の状態を備えました。

### 結果

- 2 億レコードの論理削除は予定していた期日内に完了しました。
- 論理削除期間中に問題が何回か発生したが、事前準備のおかげで、冷静に対応ができました。
- 削除対象のレコードはユーザのノイズになっていた情報だったため、レコード・機能を削除したおかげで、本当に価値のある情報を会員が見つけやすくなり会員体験が改善しました。
